---
name: opencc-algorithm-explain
description: 解釋 OpenCC 的核心演算法、架構設計與理論局限性
tags: [algorithm, architecture, theory, opencc]
---

# OpenCC 演算法解釋技能

此技能協助解釋 OpenCC 的內部運作原理、設計決策與局限性。

## 使用時機

當用戶詢問：
- OpenCC 如何運作？
- 為什麼某些轉換會出錯？
- OpenCC 與其他轉換工具的差異？
- 如何改進轉換準確度？

## 核心概念

### 1. 最大正向匹配分詞（MaxMatch）

**原理**：從左到右掃描，每次匹配最長的詞條。

**範例**：

詞典：`一`, `一個`, `一個人`
輸入：`一個人去`

```
位置 0: 嘗試 "一個人去" (4) → ✗
位置 0: 嘗試 "一個人" (3) → ✓
位置 3: 嘗試 "去" (1) → 保留
結果: [一個人] [去]
```

**優點**：
- 快速（O(n)，n 為文本長度）
- 確定性（相同輸入必定相同輸出）
- 無需訓練

**缺點**：
- 不考慮上下文
- 貪婪策略可能非最優解
- 依賴詞典完整性

### 2. 轉換鏈機制

**流程**：配置 → 分詞 → 多階段轉換 → 輸出

**範例**（`s2twp.json`）：

```
簡體文字
  ↓ 階段 1: STPhrases + STCharacters
繁體文字
  ↓ 階段 2: TWPhrases
臺灣慣用詞
  ↓ 階段 3: TWVariants
臺灣標準繁體
```

每階段的輸出成為下一階段的輸入。

### 3. 詞典優先級

在 `DictGroup` 中，詞典依序查詢：

```
查詢 "干燥" → STPhrases (命中) → "乾燥" ✓
查詢 "干"   → STPhrases (未中) → STCharacters (命中) → "乾"
```

這實現「詞組優先，單字後備」策略。

## 理論局限性

### 1. 一對多歧義問題

**根本原因**：缺乏語義理解和上下文分析。

| 簡體 | 可能的繁體 | 語境範例 |
|------|-----------|---------|
| 干 | 乾、幹、干 | 乾燥、幹活、干擾 |
| 后 | 後、后 | 後天、皇后 |
| 面 | 麵、面 | 麵條、面孔 |

**OpenCC 解法**：窮舉詞組

```
# STPhrases.txt
干燥	乾燥
干扰	干擾
干活	幹活
```

**局限**：
- 詞典會無限膨脹
- 無法處理未登錄詞
- 新詞、網路用語需要人工新增

### 2. 缺乏上下文理解

**問題案例**：

```
輸入: "后天就是星期一"
理想: "後天就是星期一" ✓

輸入: "皇后天生麗質"
可能: "皇後天生麗質" ✗ (應為 "皇后")
```

如果詞典有 `后天 → 後天`，第二句可能被錯誤分詞。

**根本原因**：
- MaxMatch 只看局部，不看全局
- 不理解「皇后」是一個完整詞彙
- 需要將「皇后」也加入詞典

### 3. 不使用語言模型

**對比**：

| 方法 | 上下文 | 概率 | 新詞 | 速度 | 維護 |
|------|-------|------|------|------|------|
| OpenCC（規則） | ✗ | ✗ | ✗ | 極快 | 高 |
| 統計模型（N-gram） | 有限 | ✓ | 有限 | 中 | 中 |
| 神經網路（Transformer） | ✓ | ✓ | ✓ | 慢 | 低 |

**OpenCC 的權衡**：
- 選擇速度、確定性、輕量級
- 犧牲了語義理解和自動學習能力

### 4. 維護負擔

**數據規模**：
- `STPhrases.txt`：~60,000 詞條
- `TWPhrases*.txt`：~50,000 詞條

**挑戰**：
- 每個錯誤案例可能需要新增多個詞條
- 詞條衝突需要人工仲裁
- 地區差異（大陸、臺灣、香港）需分別處理
- 專業領域術語需專家審核

## 何時使用 OpenCC？

**適合場景**：
- ✓ 通用文本轉換
- ✓ 需要高效能（即時轉換）
- ✓ 需要確定性（相同輸入必定相同輸出）
- ✓ 輕量級部署（瀏覽器、移動端）

**不適合場景**：
- ✗ 大量未登錄詞（新詞、網路用語）
- ✗ 高度專業化領域（需要語境理解）
- ✗ 需要自動學習新模式

## 改進建議

**短期**（在現有框架內）：
1. 持續豐富詞典
2. 社群回報問題並提交 PR
3. 針對特定領域建立自訂詞典

**長期**（架構升級）：
1. 引入統計語言模型輔助歧義消解
2. 使用深度學習處理未登錄詞
3. 提供混合模式（規則 + 模型）

但這會增加複雜度和計算成本，需要仔細權衡。

## 參考資料

- **[doc/ALGORITHM_AND_LIMITATIONS.md](../doc/ALGORITHM_AND_LIMITATIONS.md)** - 完整的演算法與局限性分析
- **[AGENTS.md](../AGENTS.md)** - 專案架構速覽
- **[src/README.md](../src/README.md)** - 核心模組技術文件
